<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Quotation Details</title>
    <ui:include src="/_includes/header.xhtml"/>
</h:head>
<h:body>
    <h:outputText
            value="#{loginBean.checkAccessRedirectHome(act.pageQuotationDetails)}"/>
    <ui:include src="/_includes/top.xhtml"/>
    <ui:include src="/_includes/side.xhtml"/>
    <div>
        <div class="w3-main">
            <div class="w3-container">
                <div id="title-div" align="center" class="w3-padding-8">
                    <h:outputText value="Quotation ID # #{quotationDetailsBean.quotation.id}"
                                  styleClass="q-large-text"/>
                    <br/>
                    <h:outputText value="Amount: " styleClass="q-med-text w3-text-green" />
                    <h:outputText value="#{quotationDetailsBean.quotation.totalSalesPrice + 35 + (quotationDetailsBean.quotation.totalSalesPrice * 0.05)}"
                                  styleClass="q-med-text w3-text-green">
                        <f:convertNumber type="currency" currencySymbol="SR "/>
                    </h:outputText>
                </div>
                <h:form id="form-g">
                    <p:growl id="error-growl"
                             rendered="#{facesContext.maximumSeverity.ordinal eq 2}"/>
                    <p:growl id="success-growl"
                             rendered="#{facesContext.maximumSeverity.ordinal eq 0}"/>
                </h:form>
                <div class="w3-row">
                    <div id="info-div" class="w3-col s12 w3-padding-24">
                        <p:panel toggleable="true" header="Quotation Information" collapsed="false"
                                 toggleSpeed="100">
                            <div class="w3-row">
                                <div class="w3-col s12 m6 w3-border">
                                    <table class="w3-table w3-striped">
                                        <tr>
                                            <td><h:outputLabel value="Quotation Status" styleClass="q-bold"/></td>
                                            <td>
                                                <h:outputText value="Waiting for Quotation" rendered="#{quotationDetailsBean.quotation.status eq 'W'}" styleClass="w3-tag w3-indigo" />
                                                <h:outputText value="Archived" rendered="#{quotationDetailsBean.quotation.status eq 'X'}" styleClass="w3-tag" />
                                                <h:outputText value="Submitted" rendered="#{quotationDetailsBean.quotation.status eq 'S'}" styleClass="w3-tag w3-green" />
                                                <h:outputText value="Edit Request" rendered="#{quotationDetailsBean.quotation.status eq 'A'}" styleClass="w3-tag w3-teal" />
                                                <h:outputText value="No Items found" rendered="#{quotationDetailsBean.quotation.status eq 'R'}" styleClass="w3-tag w3-indigo" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="Read" styleClass="q-bold"/></td>
                                            <td>
                                                <h:outputText value="#{quotationDetailsBean.quotation.read eq true ? 'YES': 'NO'}" rendered="#{quotationDetailsBean.quotation.status eq 'S'}" styleClass="w3-tag w3-#{quotationDetailsBean.quotation.read eq true ? 'green' : 'red'}" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="Read Date" styleClass="q-bold"/></td>
                                            <td>
                                                <h:outputText value="#{quotationDetailsBean.quotation.readOn}" >
                                                    <f:convertDateTime pattern="dd-MMM-yyyy HH:mm"/>
                                                </h:outputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="Quotation ID" styleClass="q-bold"/></td>
                                            <td><h:outputText value="#{quotationDetailsBean.quotation.id}"/></td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="Request Date" styleClass="q-bold"/></td>
                                            <td><h:outputText value="#{quotationDetailsBean.quotation.created}">
                                                <f:convertDateTime pattern="dd-MMM-yyyy HH:mm"/>
                                            </h:outputText></td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="Vehicle" styleClass="q-bold"/></td>
                                            <td><h:outputText value="#{makesBean.getModelYearFromId(quotationDetailsBean.quotation.customerVehicle.vehicleYearId).fullName}"/></td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel value="VIN" styleClass="q-bold"/></td>
                                            <td><h:outputText value="#{quotationDetailsBean.quotation.customerVehicle.vin}"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="w3-col s12 m6 w3-border">
                                    <table class="w3-table w3-striped">
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Customer ID"/></td>
                                            <td><h:outputLink value="customer-details?id=#{quotationDetailsBean.customer.id}"><h:outputText value="#{quotationDetailsBean.customer.id}"/></h:outputLink></td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Name"/></td>
                                            <td><h:outputText
                                                    value="#{quotationDetailsBean.customer.fullName}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Joined"/></td>
                                            <td><h:outputText
                                                    value="#{quotationDetailsBean.customer.created}">
                                                <f:convertDateTime pattern="dd-MMM-yyyy HH:mm"/>
                                            </h:outputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Email"/></td>
                                            <td><h:outputText readonly="true"
                                                              value="#{quotationDetailsBean.customer.email}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Customer Status"/></td>
                                            <td>
                                                <h:outputText value="#{quotationDetailsBean.customer.status eq 'V' ? 'Active' : 'Unverified'}" styleClass="w3-tag w3-#{quotationDetailsBean.customer.status eq 'V' ? 'green' : 'red'}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="Mobile"/></td>
                                            <td><h:outputText
                                                    value="#{quotationDetailsBean.quotation.mobile}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputLabel styleClass="q-bold" value="City"/></td>
                                            <td><h:outputText
                                                    value="#{cityBean.getCityFromId(quotationDetailsBean.quotation.cityId).country.name} - #{cityBean.getCityFromId(quotationDetailsBean.quotation.cityId).region.name} - #{cityBean.getCityFromId(quotationDetailsBean.quotation.cityId).name}"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </p:panel>
                    </div>
                    <div id="comments-div" class="w3-col s12 m6 w3-padding-24 w3-container">
                        <p:panel toggleable="true" id="comments-panel"
                                 header="Comments #{quotationDetailsBean.quotation.comments.size() gt 0 ? quotationDetailsBean.quotation.comments.size() : ' '}"
                                 collapsed="false"
                                 toggleSpeed="100">
                            <ui:repeat var="comment" id="comments-repeat"
                                       value="#{quotationDetailsBean.quotation.comments}">
                                <h:outputText value="#{comment.created}" styleClass="q-bold"
                                              style="color:#2dacd1!important;">
                                    <f:convertDateTime pattern="dd-MMM-yyyy hh:mm"/>
                                </h:outputText>
                                <h:outputText
                                        value="#{comment.createdBy} - #{usersBean.getUserFromId(comment.createdBy).firstName}: "
                                        styleClass="q-bold" style="color:#2dacd1!important;"/>
                                <h:outputText
                                        value=" (#{comment.visibleToCustomer ? 'visible' : 'hidden'}) : "
                                        style="color:#2dacd1!important;" styleClass="q-bold"/>
                                <h:outputText dir="rtl" value=" #{comment.text}"/>
                                <br/>
                                <br/>
                            </ui:repeat>

                            <p:commandButton value="+" styleClass="q-btn"
                                             oncomplete="PF('commentDlgwv').show()"/>
                        </p:panel>
                    </div>
                    <div id="emails-div" class="w3-col s12 m6 w3-padding-24 w3-container">
                        <p:panel toggleable="true" id="emails-panel"
                                 header="Emails #{quotationDetailsBean.quotationRelatedEmails.size() gt 0 ? quotationDetailsBean.quotationRelatedEmails.size() : ' '}"
                                 collapsed="false"
                                 toggleSpeed="100">
                            <h:dataTable value="#{quotationDetailsBean.quotationRelatedEmails}" var="es" styleClass="w3-table w3-striped w3-border" headerClass="w3-light-grey w3-border-bottom">
                                <h:column>
                                    <f:facet name="header">
                                        <h:outputText value="Date Sent"/>
                                    </f:facet>
                                    <h:outputText value="#{es.created}">
                                        <f:convertDateTime pattern="dd-MMM-yyyy HH:mm"/>
                                    </h:outputText>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        <h:outputText value="Status"/>
                                    </f:facet>
                                    <h:outputText value="#{es.status}"/>
                                </h:column>

                            </h:dataTable>

                            <p:commandButton value="Resend" styleClass="q-btn" rendered="#{quotationDetailsBean.quotation.status eq 'S'}"
                                             oncomplete="PF('newEmailDlgwv').show()"/>
                        </p:panel>
                    </div>
                    <div id="products-div" class="w3-col s12 w3-padding-24">
                        <p:panel toggleable="true" header="Products" collapsed="false"
                                 toggleSpeed="100">
                            <h:dataTable styleClass="w3-table w3-striped w3-border"
                                         headerClass="w3-light-grey w3-border-bottom"
                                         footerClass="w3-light-grey w3-border"
                                         value="#{quotationDetailsBean.quotation.allBillItems}"
                                         var="bi"
                                         columnClasses="q-hide-small,q,q-hide-small,q,q-hide-small,q-hide-small,q-hide-small">
                                <f:facet name="header">
                                    <div align="center">Bill Items</div>
                                </f:facet>
                                <h:column headerClass="q-hide-small w3-light-grey w3-border-bottom">
                                    <f:facet name="header">
                                        Item ID
                                    </f:facet>
                                    <h:outputText value="#{bi.id}"/>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        Desc
                                    </f:facet>
                                    <h:outputText value="#{bi.itemDesc}"/>
                                </h:column>
                                <h:column headerClass="q-hide-small w3-light-grey w3-border-bottom">
                                    <f:facet name="header">
                                        <h:outputText value="STATUS"/>
                                    </f:facet>
                                    <h:outputText value="Completed" rendered="#{bi.status eq 'C'}" styleClass="w3-tag w3-green"/>
                                    <h:outputText value="Under Review" rendered="#{bi.status eq 'W'}" styleClass="w3-tag w3-indigo"/>
                                    <h:outputText value="Not Available" rendered="#{bi.status eq 'N'}" styleClass="w3-tag w3-red"/>
                                    <h:outputText value="Deleted" rendered="#{bi.status eq 'X'}" styleClass="w3-tag" />
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        Product ID
                                    </f:facet>
                                    <h:outputLink value="product-details?id=#{bi.billItemResponse.productId}" target="_blank" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}">
                                      <h:outputText value="#{bi.billItemResponse.productId}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}"/>
                                    </h:outputLink>
                                </h:column>
                                <h:column headerClass="q-hide-small w3-light-grey w3-border-bottom">
                                    <f:facet name="header">
                                        English Name
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.productHolder.product.desc}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}"/>
                                </h:column>
                                <h:column headerClass="q-hide-small w3-light-grey w3-border-bottom">
                                    <f:facet name="header">
                                        Arabic Name
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.productHolder.product.descAr}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}"/>
                                </h:column>
                                <h:column headerClass="q-hide-small w3-light-grey w3-border-bottom">
                                    <f:facet name="header">
                                        Product Number
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.productHolder.product.productNumber}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}"/>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        Quantity
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.quantity}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}"/>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        Unit Price
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.productHolder.averageSalesPrices}" rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}">
                                        <f:convertNumber type="currency" currencySymbol="SR "/>
                                    </h:outputText>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">
                                        Gross Price
                                    </f:facet>
                                    <h:outputText value="#{bi.billItemResponse.productHolder.averageSalesPrices * bi.quantity}"
                                                  rendered="#{bi.hasSavedResponse() and bi.status eq 'C'}">
                                        <f:convertNumber type="currency" currencySymbol="SR "/>
                                    </h:outputText>
                                </h:column>
                                <f:facet name="footer">
                                    <div class="w3-row">
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="Total Products"/>
                                        </div>
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="#{quotationDetailsBean.quotation.totalSalesPrice}">
                                                <f:convertNumber type="currency" currencySymbol="SR "/>
                                            </h:outputText>
                                        </div>
                                    </div>
                                    <div class="w3-row">
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="Delivery"/>
                                        </div>
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="#{35}">
                                                <f:convertNumber type="currency" currencySymbol="SR "/>
                                            </h:outputText>
                                        </div>
                                    </div>
                                    <div class="w3-row">
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="Subtotal" styleClass="q-bold"/>
                                        </div>
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="#{quotationDetailsBean.quotation.totalSalesPrice + 35}"
                                                          styleClass="q-bold">
                                                <f:convertNumber type="currency" currencySymbol="SR "/>
                                            </h:outputText>
                                        </div>
                                    </div>
                                    <div class="w3-row">
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="VAT"/>
                                        </div>
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="#{quotationDetailsBean.quotation.totalSalesPrice * 0.05}">
                                                <f:convertNumber type="currency" currencySymbol="SR "/>
                                            </h:outputText>
                                        </div>
                                    </div>
                                    <div class="w3-row">
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="Total" styleClass="q-bold"/>
                                        </div>
                                        <div class="w3-col s6 m1">
                                            <h:outputText value="#{quotationDetailsBean.quotation.totalSalesPrice + 35 + (quotationDetailsBean.quotation.totalSalesPrice * 0.05)}"
                                                          styleClass="q-bold">
                                                <f:convertNumber type="currency" currencySymbol="SR "/>
                                            </h:outputText>
                                        </div>
                                    </div>
                                </f:facet>
                            </h:dataTable>
                        </p:panel>
                    </div>
                    <h:form>
                        <div align="center">
                            <p:commandButton value="Create Cart" styleClass="q-btn" actionListener="#{quotationDetailsBean.initCart}" oncomplete="PF('cartDlgwv').show()" update=":cart-form"/>
                        </div>
                    </h:form>
                </div>
                <br/>
                <br/>
                <br/>
            </div>
        </div>
    </div>

    <h:form id="cart-form">
        <p:dialog styleClass="q-dialog" header="Cart" widgetVar="cartDlgwv">
            <h:panelGroup id="cart-panel">
                <h:dataTable value="#{quotationDetailsBean.cart.cartProducts}" var="cp" styleClass="w3-table w3-striped w3-border">
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="PRODUCT ID"/>
                    </f:facet>
                    <h:outputText value="#{cp.productHolder.product.id}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="DESC."/>
                    </f:facet>
                    <h:outputText value="#{cp.productHolder.product.desc}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="NUMBER"/>
                    </f:facet>
                    <h:outputText value="#{cp.productHolder.product.productNumber}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="QUANTITY"/>
                    </f:facet>
                    <h:selectOneMenu value="#{cp.newQuantity}">
                        <f:selectItems value="#{cp.quantityArray20}" var="q" itemLabel="#{q}" itemValue="#{q}"/>
                        <f:ajax execute="@this" render="cart-form:cart-panel"/>
                    </h:selectOneMenu>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="UNIT PRICE"/>
                    </f:facet>
                    <h:outputText value="#{cp.productHolder.averageSalesPrices}">
                        <f:convertNumber type="currency" currencySymbol="SR "/>
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="GROSS PRICE"/>
                    </f:facet>
                    <h:outputText value="#{cp.productHolder.averageSalesPrices * cp.newQuantity}">
                        <f:convertNumber type="currency" currencySymbol="SR "/>
                    </h:outputText>
                </h:column>
                <f:facet name="footer">
                    <div class="w3-row">
                        <div class="w3-col s6">
                            <h:outputText value="Total Products"/>
                        </div>
                        <div class="w3-col s6">
                            <h:outputText value="#{quotationDetailsBean.cart.productsTotalNewQuantity}">
                                <f:convertNumber type="currency" currencySymbol="SR "/>
                            </h:outputText>
                        </div>
                    </div>
                    <div class="w3-row">
                        <div class="w3-col s6">
                            <h:outputText value="Delivery"/>
                        </div>
                        <div class="w3-col s6">
                            <h:outputText value="#{quotationDetailsBean.cart.deliveryFees}">
                                <f:convertNumber type="currency" currencySymbol="SR "/>
                            </h:outputText>
                        </div>
                    </div>
                    <div class="w3-row">
                        <div class="w3-col s6">
                            <h:outputText value="Subtotal" styleClass="q-bold"/>
                        </div>
                        <div class="w3-col s6">
                            <h:outputText value="#{quotationDetailsBean.cart.subTotalNewQuantity}"
                                          styleClass="q-bold">
                                <f:convertNumber type="currency" currencySymbol="SR "/>
                            </h:outputText>
                        </div>
                    </div>
                    <div class="w3-row">
                        <div class="w3-col s6">
                            <h:outputText value="VAT"/>
                        </div>
                        <div class="w3-col s6">
                            <h:outputText value="#{quotationDetailsBean.cart.vatNewQuantity}">
                                <f:convertNumber type="currency" currencySymbol="SR "/>
                            </h:outputText>
                        </div>
                    </div>
                    <div class="w3-row">
                        <div class="w3-col s6">
                            <h:outputText value="Total" styleClass="q-bold"/>
                        </div>
                        <div class="w3-col s6">
                            <h:outputText value="#{quotationDetailsBean.cart.grandTotalNewQuantity}"
                                          styleClass="q-bold">
                                <f:convertNumber type="currency" currencySymbol="SR "/>
                            </h:outputText>
                        </div>
                    </div>
                </f:facet>
            </h:dataTable>
                <br/>
                <h:panelGrid columns="2">
                    <h:outputText value="Delivery Charges"/>
                    <h:inputText value="#{quotationDetailsBean.cart.cartDelivery.deliveryCharges}" required="true">
                        <f:ajax execute="@this" render="cart-form:cart-panel"/>
                    </h:inputText>
                    <h:outputText value="Address"/>
                    <h:selectOneMenu value="#{quotationDetailsBean.cart.cartDelivery.addressId}" required="true">
                        <f:selectItems value="#{quotationDetailsBean.customer.addresses}" var="address" itemValue="#{address.id}" itemLabel="#{address.title}"/>
                    </h:selectOneMenu>
                    <h:outputText value="Payment Method"/>
                    <h:outputText value="Wire Transfer"/>
                </h:panelGrid>
                <div align="center">
                    <p:commandButton value="Create Cart" styleClass="q-btn" actionListener="#{quotationDetailsBean.createCart()}" update=":form-g" oncomplete="PF('cartDlgwv').hide()"/>
                </div>
            </h:panelGroup>
        </p:dialog>
    </h:form>

    <h:form id="new-comment-form">
        <p:dialog styleClass="q-dialog" header="New Comment"
                  widgetVar="commentDlgwv">
            <div align="center">
                <h:outputText value="Visible to Customer"/>
                <br/>
                <h:selectBooleanCheckbox
                        value="#{quotationDetailsBean.newComment.visibleToCustomer}"/>
                <br/>
                <div class="w3-padding-12">
                    <h:outputText value="Text"/>
                    <br/>
                    <h:inputTextarea required="true"
                                     requiredMessage="Enter comments before submitting"
                                     value="#{quotationDetailsBean.newComment.text}" cols="70"
                                     rows="3"/>
                </div>
                <div>
                    <p:commandButton value="Submit" styleClass="q-btn"
                                     actionListener="#{quotationDetailsBean.createComment()}"  update=":form-g">
                    </p:commandButton>
                </div>
            </div>
        </p:dialog>
    </h:form>
    <h:form id="new-email-form">
        <p:dialog styleClass="q-dialog" header="Resend Email"
                  widgetVar="newEmailDlgwv">
            <div align="center">
                <h:outputText value="Are you sure you want to resend the quotation email to the customer?"/>
                <br/>
                <div>
                    <p:commandButton value="Yes" styleClass="q-btn"
                                     actionListener="#{quotationDetailsBean.resendEmail}"  update=":form-g">
                    </p:commandButton>
                </div>
            </div>
        </p:dialog>
    </h:form>
</h:body>
</html>
